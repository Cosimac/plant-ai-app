# 🚀 部署指南

本指南将帮助您安全地部署植物识别小程序项目。

## 📋 部署前准备

### 1. 获取必要的API密钥

#### 百度AI开放平台
1. 访问 [百度AI开放平台](https://ai.baidu.com/)
2. 注册并登录账号
3. 创建新应用
4. 开通"植物识别"服务
5. 获取以下信息：
   - API Key
   - Secret Key

#### 微信小程序
1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 注册小程序账号
3. 获取 AppID
4. 开通云开发服务
5. 获取云环境ID

### 2. 配置环境变量

#### 本地开发环境
1. 复制环境变量模板：
   ```bash
   cp env.example .env
   ```

2. 编辑 `.env` 文件，填入真实配置：
   ```env
   # 百度AI配置
   BAIDU_API_KEY=你的百度API_Key
   BAIDU_SECRET_KEY=你的百度Secret_Key
   
   # 微信小程序配置
   WECHAT_APPID=你的微信小程序AppID
   
   # 云开发配置
   CLOUD_ENV_ID=你的云环境ID
   ```

#### 云函数环境变量
1. 打开微信开发者工具
2. 进入云开发控制台
3. 选择云函数 `identifyPlant`
4. 在"环境变量"中添加：
   - `BAIDU_API_KEY`: 你的百度API Key
   - `BAIDU_SECRET_KEY`: 你的百度Secret Key

## 🔧 部署步骤

### 1. 安装依赖
```bash
npm install
```

### 2. 构建项目
```bash
npm run build:weapp
```

### 3. 部署云函数
1. 在微信开发者工具中右键点击 `cloudfunctions/identifyPlant`
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 4. 配置小程序
1. 在微信开发者工具中打开项目
2. 修改 `project.config.json` 中的 `appid` 为你的真实AppID
3. 确保云开发环境ID正确

### 5. 测试功能
1. 在微信开发者工具中预览小程序
2. 测试植物识别功能
3. 检查云函数调用是否正常

## 🔒 安全最佳实践

### 1. 环境变量管理
- ✅ 使用环境变量存储敏感信息
- ✅ 将 `.env` 文件加入 `.gitignore`
- ✅ 使用 `env.example` 作为配置模板
- ❌ 不要在代码中硬编码密钥

### 2. 版本控制
- ✅ 提交前检查是否包含敏感信息
- ✅ 使用 `git status` 确认文件状态
- ❌ 不要提交包含真实密钥的文件

### 3. 生产环境
- ✅ 在云函数中设置环境变量
- ✅ 定期轮换API密钥
- ✅ 监控API调用量
- ❌ 不要在客户端暴露敏感信息

## 🐛 常见问题

### Q: 云函数调用失败
**A:** 检查以下几点：
1. 云函数是否正确部署
2. 环境变量是否设置正确
3. 百度AI API密钥是否有效
4. 网络连接是否正常

### Q: 植物识别返回错误
**A:** 可能的原因：
1. 图片格式不支持
2. 图片大小超出限制
3. API调用次数超限
4. 网络超时

### Q: 小程序无法连接云开发
**A:** 检查：
1. 云开发环境ID是否正确
2. 小程序AppID是否匹配
3. 云开发服务是否已开通

## 📞 技术支持

如果遇到部署问题，请：
1. 查看控制台错误信息
2. 检查网络连接
3. 确认API密钥有效性
4. 参考官方文档

## 🔄 更新部署

当需要更新项目时：
1. 拉取最新代码
2. 更新环境变量（如有变化）
3. 重新构建项目
4. 重新部署云函数
5. 测试功能是否正常